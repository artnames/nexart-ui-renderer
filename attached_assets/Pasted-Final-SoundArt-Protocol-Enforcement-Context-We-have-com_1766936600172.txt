Final SoundArt Protocol Enforcement

Context

We have completed a full migration of SoundArt rendering into the NexArt Code Mode engine.
All 14 active SoundArt styles already render deterministically via Code Mode.

However, a legacy Canvas2D fallback path still exists and must be removed to achieve full protocol compliance.

Your task is to finish the migration by enforcing Code Mode as the only rendering path for SoundArt.

‚∏ª

üéØ Goal

Make SoundArt 100% protocol-compliant by:
	‚Ä¢	Removing all runtime fallbacks to legacy Canvas2D rendering
	‚Ä¢	Ensuring every SoundArt render goes through the Code Mode engine
	‚Ä¢	Preserving determinism, seeded randomness, and frozen audio inputs
	‚Ä¢	Keeping legacy code temporarily (deprecated) but unreachable

‚∏ª

üîß Required Changes (Exact)

1Ô∏è‚É£ Remove legacy fallback in render gate (CRITICAL)

File

client/src/pages/soundart/engine/render-via-codemode.ts

Current issue
There is a try/catch block that silently falls back to:

import('./render')

which renders via Canvas2D.

Action
	‚Ä¢	Remove the fallback entirely
	‚Ä¢	Do NOT catch and downgrade errors
	‚Ä¢	Code Mode must be the only execution path

Replace the implementation of renderSoundArtSmart() with:

export async function renderSoundArtSmart(
  canvas: HTMLCanvasElement,
  sound: SoundFeatures,
  cfg: RenderCfg,
  time?: TimeFeatures,
  onProgress?: (progress: number) => void
): Promise<{
  style: SoundArtStyle;
  mode: 'soundart';
  soundFeatures: { duration: number; amplitude: number };
  metadata: SoundArtMetadata;
}> {
  // Protocol-enforced: Code Mode only
  const result = await renderSoundArtViaCodeMode(
    canvas,
    sound,
    cfg,
    time,
    onProgress
  );

  return result;
}

‚ùå No fallback
‚ùå No silent downgrade
‚úÖ Failure should surface clearly during development

‚∏ª

2Ô∏è‚É£ Deprecate legacy renderer files (DO NOT DELETE YET)

Add a clear deprecation header comment to the following files:

client/src/pages/soundart/engine/render.ts
client/src/pages/soundart/engine/styles_impl.ts
client/src/pages/soundart/engine/timeFilter.ts
client/src/pages/soundart/engine/timeFilterDynamic.ts

Header to add

/**
 * @deprecated
 * Legacy SoundArt Canvas2D renderer.
 * SoundArt is now rendered exclusively via Code Mode.
 * This file is retained temporarily for rollback safety and will be removed.
 */

Do not remove the files yet ‚Äî just ensure they are no longer imported or executed.

‚∏ª

3Ô∏è‚É£ Ensure render metadata reflects enforcement

Where render metadata is returned, ensure:

renderedVia: 'codemode'

There should be no possible runtime state where:

renderedVia === 'legacy'


‚∏ª

4Ô∏è‚É£ Verification checklist (you must confirm)

After changes, verify:
	‚Ä¢	All 14 active SoundArt styles render successfully
	‚Ä¢	Console logs never show "Rendered via: legacy"
	‚Ä¢	Seed + same audio snapshot ‚Üí identical output
	‚Ä¢	Slider / ‚ÄúTune your artwork‚Äù controls still affect visuals
	‚Ä¢	Errors surface if Code Mode fails (no silent fallback)

‚∏ª

üö´ Explicitly Do NOT
	‚Ä¢	Do NOT reintroduce Canvas2D rendering
	‚Ä¢	Do NOT add new fallbacks
	‚Ä¢	Do NOT change SoundSnapshot structure
	‚Ä¢	Do NOT alter seeded RNG or noise logic
	‚Ä¢	Do NOT modify protocol schema

‚∏ª

‚úÖ Outcome

After this change:
	‚Ä¢	SoundArt becomes a first-class protocol mode
	‚Ä¢	Rendering is fully deterministic and enforceable
	‚Ä¢	NexArt can truthfully claim protocol-native audio generative art
	‚Ä¢	SDKs and third-party builders inherit the same guarantees

‚∏ª

üß† Notes

This is a final enforcement step, not a refactor.
The architecture is already correct ‚Äî this removes the last escape hatch.

Proceed carefully and confirm each step before finalizing.

